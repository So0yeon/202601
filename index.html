<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìƒˆí•™ê¸° ì²«ë‚ , ë‚˜ì˜ ì„ íƒì€?</title>
    <!-- í°íŠ¸: ë°°ë‹¬ì˜ë¯¼ì¡± ì£¼ì•„ì²´ -->
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #FFD93D;
            --text-color: #333;
            --bg-color: #f0f8ff;
            --bar-bg: #e0e0e0;
            --stat-care: #FF6B6B;   /* ë°°ë ¤ - ë¹¨ê°• */
            --stat-respect: #4D96FF; /* ì¡´ì¤‘ - íŒŒë‘ */
            --stat-coop: #6BCB77;    /* í˜‘ë ¥ - ì´ˆë¡ */
            --stat-mind: #FFB347;    /* ë§ˆìŒ - ì£¼í™© */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Jua', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            /* ë†’ì´ ì„¤ì • ê°œì„ : ëª¨ë°”ì¼ ë¸Œë¼ìš°ì € ì£¼ì†Œì°½ ëŒ€ì‘ */
            min-height: 100vh;
            height: 100dvh; 
            overflow: hidden; 
            touch-action: manipulation;
        }

        #app {
            width: 100%;
            max-width: 500px;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%; /* ë¶€ëª¨ ë†’ì´ ìƒì† */
        }

        .hidden { display: none !important; }
        .screen {
            flex: 1;
            padding: 20px; /* íŒ¨ë”© ì•½ê°„ í™•ë³´ */
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch; /* ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ */
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì••ì¶• */
        .btn {
            background: var(--primary-color);
            border: none;
            padding: 12px 20px;
            font-size: 1.1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            width: 100%;
            margin: 6px 0;
            box-shadow: 0 3px 0 #E6C229;
            position: relative;
        }
        .btn:active {
            transform: translateY(3px);
            box-shadow: none;
        }
        .btn:disabled {
            background: #ccc;
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }
        .btn-choice {
            background: white;
            border: 2px solid var(--primary-color);
            box-shadow: 0 3px 0 #eee;
            text-align: left;
            font-size: 1rem;
            line-height: 1.3;
        }
        .btn-choice:hover:not(:disabled) {
            background: #fff9db;
        }

        /* 1. ì‹œì‘ í™”ë©´ */
        #start-screen {
            background: linear-gradient(180deg, #fff 0%, #e6f7ff 100%);
            /* justify-content: center ì œê±° -> margin: autoë¡œ ëŒ€ì²´í•˜ì—¬ ì˜ë¦¼ ë°©ì§€ */
        }
        /* ì‹œì‘ í™”ë©´ ë‚´ë¶€ ì»¨í…ì¸  ë˜í¼ (ì•ˆì „í•œ ì¤‘ì•™ ì •ë ¬ìš©) */
        .start-content-wrapper {
            margin: auto 0;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .title-box { margin-bottom: 20px; }
        .title-box h1 {
            font-size: 2.2rem;
            color: #4D96FF;
            text-shadow: 2px 2px 0 #fff;
            line-height: 1.2; /* ì¤„ê°„ê²© í™•ë³´ */
            padding-top: 5px; /* í°íŠ¸ ìœ—ë¶€ë¶„ ì˜ë¦¼ ë°©ì§€ */
        }
        .input-group { width: 100%; margin-bottom: 15px; }
        input[type="text"] {
            width: 100%;
            padding: 12px;
            font-size: 1.1rem;
            border: 2px solid #ddd;
            border-radius: 12px;
            text-align: center;
        }
        
        .char-select {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 0 auto 20px;
            width: 100%;
            max-width: 260px;
            justify-items: center;
        }
        .char-option {
            width: 100%;
            aspect-ratio: 1;
            border: 3px solid transparent;
            border-radius: 50%;
            cursor: pointer;
            transition: 0.2s;
            background-size: cover;
            background-position: center;
            background-color: #eee;
        }
        .char-option.selected {
            border-color: var(--primary-color);
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255, 217, 61, 0.5);
        }

        /* 2. ê²Œì„ í™”ë©´ í—¤ë” */
        #game-header {
            width: 100%;
            padding: 8px 15px;
            background: rgba(255,255,255,0.98);
            z-index: 50;
            border-bottom: 1px solid #eee;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 15px;
            height: 90px;
            flex-shrink: 0;
        }
        
        .player-info-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 60px;
        }
        .header-char-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #eee;
            background-size: cover;
            background-position: center;
            border: 2px solid var(--primary-color);
            margin-bottom: 4px;
        }
        .header-player-name {
            font-size: 0.9rem;
            font-weight: bold;
            color: #333;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 70px;
        }

        .stat-container {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px 12px;
        }
        .stat-item {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            position: relative;
        }
        .stat-label { width: 30px; font-weight: bold; font-size: 0.8rem; }
        .progress-bg {
            flex: 1;
            height: 10px;
            background: var(--bar-bg);
            border-radius: 5px;
            overflow: hidden;
            margin: 0 6px;
        }
        .progress-bar {
            height: 100%;
            width: 50%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .stat-value {
            width: 25px;
            text-align: right;
            font-weight: bold;
            color: #555;
            font-size: 0.8rem;
        }

        .stat-float {
            position: absolute;
            right: 30px;
            top: -10px;
            font-weight: bold;
            font-size: 1rem;
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
            text-shadow: 1px 1px 0 #fff;
            z-index: 100;
        }
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-15px); opacity: 0; }
        }
        .plus { color: #2ecc71; }
        .minus { color: #e74c3c; }

        #scene-area {
            flex: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* justify-content: center ì œê±° -> ì•ˆì „í•œ ì¤‘ì•™ ì •ë ¬ë¡œ ë³€ê²½ */
            margin: auto 0; 
            padding-bottom: 10px;
        }
        .scene-img-box {
            width: 100%;
            height: 180px;
            background-color: #eee;
            border-radius: 12px;
            margin: 10px 0;
            overflow: hidden;
            position: relative;
            flex-shrink: 0;
        }
        .scene-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 5s ease;
        }
        .zoom-in .scene-img { transform: scale(1.1); }

        .scene-text {
            font-size: 1.15rem;
            line-height: 1.5;
            margin-bottom: 10px;
            word-break: keep-all;
            background: #fff;
            padding: 5px 10px;
            border-radius: 10px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .dark-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 5;
        }
        .dark-mood .dark-overlay { opacity: 1; }

        /* 3. ì—”ë”© í™”ë©´ */
        #ending-card {
            background: white;
            padding: 15px;
            border-radius: 20px;
            border: 3px solid #eee;
            width: 100%;
            margin-bottom: 10px;
            /* flex: 1 ì œê±°í•˜ê³  margin: autoë¡œ ì•ˆì „í•˜ê²Œ ì •ë ¬ */
            margin: auto 0 10px 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .ending-title { font-size: 1.6rem; color: #333; margin: 10px 0; }
        .ending-desc { font-size: 1rem; color: #555; margin-bottom: 15px; line-height: 1.5; white-space: pre-line; }
        .final-score-box { background: #f9f9f9; padding: 10px; border-radius: 10px; margin-top: auto; }
        .score-text { font-size: 1.4rem; font-weight: bold; color: var(--primary-color); }

        #toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 100;
        }
        
        /* ëª¨ë°”ì¼ ì„¸ë¡œ ëª¨ë“œ ìµœì í™” */
        @media (max-height: 700px) {
            .scene-img-box { height: 150px; margin: 5px 0; }
            .scene-text { font-size: 1rem; margin-bottom: 5px; min-height: 50px; }
            .btn { padding: 10px; font-size: 0.95rem; margin: 4px 0; }
            #game-header { height: 80px; padding: 5px 15px; }
            .header-char-img { width: 40px; height: 40px; }
        }
    </style>
</head>
<body>

<div id="app">
    <!-- 1. ì‹œì‘ í™”ë©´ -->
    <div id="start-screen" class="screen">
        <div class="start-content-wrapper">
            <div class="title-box">
                <p style="font-size: 1.1rem; margin-bottom: 5px;">ë‘ê·¼ë‘ê·¼ ìƒˆí•™ê¸°</p>
                <h1>ë‚˜ì˜ í•™êµìƒí™œ<br>ì„ íƒ ê²Œì„</h1>
            </div>

            <div class="input-group">
                <p style="margin-bottom: 8px;">ì´ë¦„ì„ ì•Œë ¤ì¤˜!</p>
                <input type="text" id="player-name" placeholder="ì´ë¦„ ì…ë ¥" maxlength="6">
            </div>

            <div class="input-group">
                <p style="margin-bottom: 8px;">ìºë¦­í„°ë¥¼ ì„ íƒí•´ì¤˜!</p>
                <div class="char-select">
                    <div class="char-option" id="char-01" onclick="selectChar('01')" style="background-image: url('./images/char_01.png');"></div>
                    <div class="char-option" id="char-02" onclick="selectChar('02')" style="background-image: url('./images/char_02.png');"></div>
                    <div class="char-option" id="char-03" onclick="selectChar('03')" style="background-image: url('./images/char_03.png');"></div>
                    <div class="char-option" id="char-04" onclick="selectChar('04')" style="background-image: url('./images/char_04.png');"></div>
                </div>
            </div>

            <button class="btn" onclick="startGame()">ë“±êµí•˜ê¸°!</button>
        </div>
    </div>

    <!-- 2. ê²Œì„ ì§„í–‰ í™”ë©´ -->
    <div id="game-screen" class="screen hidden">
        <div id="game-header">
            <!-- ìºë¦­í„° ì •ë³´ í‘œì‹œ ì˜ì—­ ì¶”ê°€ -->
            <div class="player-info-area">
                <div id="header-char-img" class="header-char-img"></div>
                <span id="header-player-name" class="header-player-name"></span>
            </div>

            <!-- ìŠ¤íƒ¯ ê²Œì´ì§€ë°” -->
            <div class="stat-container">
                <div class="stat-item" id="stat-box-care">
                    <span class="stat-label">ë°°ë ¤</span>
                    <div class="progress-bg"><div id="bar-care" class="progress-bar" style="background: var(--stat-care);"></div></div>
                    <span id="val-care" class="stat-value">50</span>
                </div>
                <div class="stat-item" id="stat-box-respect">
                    <span class="stat-label">ì¡´ì¤‘</span>
                    <div class="progress-bg"><div id="bar-respect" class="progress-bar" style="background: var(--stat-respect);"></div></div>
                    <span id="val-respect" class="stat-value">50</span>
                </div>
                <div class="stat-item" id="stat-box-coop">
                    <span class="stat-label">í˜‘ë ¥</span>
                    <div class="progress-bg"><div id="bar-coop" class="progress-bar" style="background: var(--stat-coop);"></div></div>
                    <span id="val-coop" class="stat-value">50</span>
                </div>
                <div class="stat-item" id="stat-box-mind">
                    <span class="stat-label">ë§ˆìŒ</span>
                    <div class="progress-bg"><div id="bar-mind" class="progress-bar" style="background: var(--stat-mind);"></div></div>
                    <span id="val-mind" class="stat-value">50</span>
                </div>
            </div>
        </div>

        <div id="scene-area">
            <div class="scene-img-box" id="scene-box">
                <img id="scene-img" class="scene-img" src="" alt="ì¥ë©´ ì´ë¯¸ì§€" onerror="this.src='https://via.placeholder.com/500x180?text=No+Image'">
                <div class="dark-overlay"></div>
            </div>
            <p id="scene-text" class="scene-text">ì¥ë©´ ì„¤ëª…ì´ ì—¬ê¸°ì— ë‚˜ì˜µë‹ˆë‹¤.</p>
            
            <div id="choices-container" style="width: 100%;">
                <!-- ë²„íŠ¼ì´ JSë¡œ ìƒì„±ë¨ -->
            </div>
        </div>
    </div>

    <!-- 3. ì—”ë”© í™”ë©´ -->
    <div id="ending-screen" class="screen hidden">
        <div id="ending-card">
            <div class="scene-img-box" style="height: 180px; flex-shrink: 0;">
                <img id="ending-img" class="scene-img" src="" alt="ì—”ë”©" onerror="this.src='https://via.placeholder.com/500x180?text=Ending'">
            </div>
            <h2 id="ending-title" class="ending-title">ì—”ë”© ì œëª©</h2>
            <p id="ending-desc" class="ending-desc">ì—”ë”© ë‚´ìš©</p>
            
            <div class="final-score-box">
                <p><span id="final-name"></span>ë‹˜ì˜ í•™êµìƒí™œ ì ìˆ˜ëŠ”?</p>
                <div class="score-text"><span id="total-score">0</span>ì </div>
            </div>
        </div>
        
        <button class="btn" onclick="saveEndingImage()">ğŸ“¸ ì¶”ì–µ ì €ì¥í•˜ê¸°</button>
        <button class="btn" style="background-color: #eee;" onclick="location.reload()">ğŸ”„ ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°</button>
    </div>
    
    <div id="toast">ì´ë¯¸ì§€ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
</div>

<script>
    // --- ê²Œì„ ë°ì´í„° ì„¤ì • ---
    const startStats = 50;
    let currentScene = 0;
    let player = { name: "", char: "" };
    let stats = { care: startStats, respect: startStats, coop: startStats, mind: startStats };

    // 12ê°œ ì¥ë©´ ë°ì´í„°
    const scenes = [
        {
            text: "ìƒˆí•™ê¸° ì²« ë“±êµê¸¸! í•™êµ ì• íš¡ë‹¨ë³´ë„ì—ì„œ ì €í•™ë…„ ë™ìƒì´ ì‹¤ë‚´í™” ê°€ë°©ì„ ë–¨ì–´ëœ¨ë ¸ì–´. ì–´ë–»ê²Œ í• ê¹Œ?",
            image: "./images/bg_01.jpg",
            choices: [
                { text: "ì–¼ë¥¸ ë›°ì–´ê°€ì„œ ê°™ì´ ì£¼ì›Œì¤€ë‹¤.", effects: { care: 10, mind: 5 } },
                { text: "ë’¤ì— ì°¨ê°€ ì˜¤ëŠ”ì§€ ë´ì£¼ë©° ê¸°ë‹¤ë ¤ì¤€ë‹¤.", effects: { care: 5, respect: 3 } },
                { text: "ì§€ê°í•˜ê² ì–´! ëª¨ë¥¸ ì²™ ì§€ë‚˜ê°„ë‹¤.", effects: { care: -5, mind: -2 } }
            ]
        },
        {
            text: "êµì‹¤ì— ë“¤ì–´ì™”ì–´. ë‹´ì„ ì„ ìƒë‹˜ì´ ë°˜ê°‘ê²Œ ì¸ì‚¬ë¥¼ ê±´ë„¤ì‹œë„¤?",
            image: "./images/bg_02.jpg",
            choices: [
                { text: "í° ì†Œë¦¬ë¡œ 'ì•ˆë…•í•˜ì„¸ìš”!' ë°°ê¼½ ì¸ì‚¬ë¥¼ í•œë‹¤.", effects: { respect: 10, mind: 5 } },
                { text: "ëˆˆì„ ë§ˆì£¼ì¹˜ë©° ê°€ë³ê²Œ ëª©ë¡€í•œë‹¤.", effects: { respect: 5 } },
                { text: "ë¶€ë„ëŸ¬ì›Œì„œ ê³ ê°œë¥¼ ìˆ™ì´ê³  ìë¦¬ë¡œ ê°„ë‹¤.", effects: { mind: -3, respect: -2 } }
            ]
        },
        {
            text: "1êµì‹œ ìˆ˜ì—… ì‹œê°„, ì„ ìƒë‹˜ ë§ì”€ì´ ì¡°ê¸ˆ ì–´ë µë„¤. ì§‘ì¤‘ì´ ì˜ ì•ˆ ë˜ëŠ”ë°...",
            image: "./images/bg_03.jpg",
            choices: [
                { text: "í—ˆë¦¬ë¥¼ í´ê³  ì„ ìƒë‹˜ ëˆˆì„ ë³´ë©° ëê¹Œì§€ ë“£ëŠ”ë‹¤.", effects: { respect: 10, mind: 5 } },
                { text: "ì¤‘ìš”í•œ ë‚´ìš©ë§Œ ë…¸íŠ¸ì— ë„ì ì—¬ ë³¸ë‹¤.", effects: { mind: 3 } },
                { text: "ëª°ë˜ ì±…ìƒ ë°‘ìœ¼ë¡œ ë”´ì§“ì„ í•œë‹¤.", effects: { respect: -10, mind: -5 } }
            ]
        },
        {
            text: "ì‰¬ëŠ” ì‹œê°„! ë³µë„ì—ì„œ ì¹œêµ¬ë“¤ì´ ë›°ì–´ë‹¤ë‹ˆë©° ì¥ë‚œì„ ì¹˜ê³  ìˆì–´.",
            image: "./images/bg_04.jpg",
            choices: [
                { text: "'ì–˜ë“¤ì•„, ë³µë„ì—ì„œëŠ” ì¡°ìš©íˆ ê±·ì'ê³  ë§í•œë‹¤.", effects: { coop: 10, respect: 5 } },
                { text: "ë¶€ë”ªíˆì§€ ì•Šê²Œ ì¡°ì‹¬íˆ í”¼í•´ ë‹¤ë‹Œë‹¤.", effects: { care: 3 } },
                { text: "ì‹ ë‚œë‹¤! ë‚˜ë„ ê°™ì´ ë›°ë©´ì„œ ë…¼ë‹¤.", effects: { respect: -8, coop: -5 } }
            ]
        },
        {
            text: "ê°„ì‹ ì‹œê°„, ì§ê¿ì´ ìš°ìœ ë¥¼ ì±…ìƒì— ìŸì•˜ì–´! ì–´ì©Œì§€?",
            image: "./images/bg_05.jpg",
            choices: [
                { text: "ë‚´ íœ´ì§€ë¥¼ êº¼ë‚´ì„œ ê°™ì´ ë‹¦ì•„ì¤€ë‹¤.", effects: { care: 12, coop: 8 } },
                { text: "ì„ ìƒë‹˜ê»˜ ë§ì”€ë“œë¦¬ê³  ê±¸ë ˆë¥¼ ê°€ì ¸ì˜¨ë‹¤.", effects: { coop: 5, care: 5 } },
                { text: "'ì•„ ë­ì•¼~' í•˜ë©° ì±…ìƒì„ ë©€ë¦¬ ë—€ë‹¤.", effects: { care: -10, mind: -5 } }
            ]
        },
        {
            text: "ì²´ìœ¡ê´€ìœ¼ë¡œ ì´ë™í•˜ëŠ” ì‹œê°„. ì¤„ì„ ì„œì„œ ê°€ì•¼ í•˜ëŠ”ë° ìê¾¸ ë’¤ì—ì„œ ë¯¸ë„¤.",
            image: "./images/bg_06.jpg",
            choices: [
                { text: "ë’¤ë¥¼ ëŒì•„ë³´ë©° 'ë°€ì§€ ë§ê³  ì²œì²œíˆ ê°€ì'ê³  í•œë‹¤.", effects: { respect: 8, coop: 5 } },
                { text: "ì•„ë¬´ ë§ ì—†ì´ ë‚´ ì•ì‚¬ëŒê³¼ì˜ ê°„ê²©ì„ ì§€í‚¨ë‹¤.", effects: { mind: 5 } },
                { text: "ì§œì¦ë‚˜ì„œ ë‚˜ë„ ë’·ì‚¬ëŒì„ ë°€ì–´ë²„ë¦°ë‹¤.", effects: { respect: -10, care: -8 } }
            ]
        },
        {
            text: "ì ì‹¬ì‹œê°„ ì „, ë°˜ ë‹¨í†¡ë°©ì— ì¹œêµ¬ í—˜ë‹´ì´ ì˜¬ë¼ì™”ì–´. ë¶„ìœ„ê¸°ê°€ ì•ˆ ì¢‹ì•„.",
            image: "./images/bg_07.jpg",
            choices: [
                { text: "'ì´ëŸ° ë§ì€ ì¹œêµ¬ê°€ ìƒì²˜ë°›ì„ ê±°ì•¼'ë¼ê³  ë³´ë‚¸ë‹¤.", effects: { mind: 12, respect: 10 } },
                { text: "ì•„ë¬´ ë§ ì—†ì´ ì¡°ìš©íˆ ë°©ì„ ë‚˜ê°„ë‹¤.", effects: { mind: -2 } },
                { text: "ì¬ë¯¸ìˆë‹¤ëŠ” ë“¯ì´ 'ã…‹ã…‹ã…‹'ì„ ë‚¨ê¸´ë‹¤.", effects: { respect: -15, care: -15 } }
            ]
        },
        {
            text: "ëª¨ë‘  í™œë™ ì‹œê°„. í•œ ì¹œêµ¬ê°€ ì˜ê²¬ì„ ë‚´ì§€ ì•Šê³  ê°€ë§Œíˆ ìˆì–´.",
            image: "./images/bg_08.jpg",
            choices: [
                { text: "'ë„¤ ìƒê°ì€ ì–´ë•Œ? ê¶ê¸ˆí•´'ë¼ê³  ë¬¼ì–´ë³¸ë‹¤.", effects: { coop: 12, care: 8 } },
                { text: "ê·¸ ì¹œêµ¬ ëª«ê¹Œì§€ ë‚´ê°€ ë‹¤ í•´ë²„ë¦°ë‹¤.", effects: { coop: -3, mind: 5 } },
                { text: "ì°¸ì—¬ ì•ˆ í•œë‹¤ê³  ì„ ìƒë‹˜ê»˜ ì´ë¥¸ë‹¤.", effects: { care: -5, coop: -8 } }
            ]
        },
        {
            text: "ê¸‰ì‹ ì‹œê°„. ë‚´ê°€ ì œì¼ ì¢‹ì•„í•˜ëŠ” ë°˜ì°¬ì´ ë‚˜ì™”ëŠ”ë° ë”± í•˜ë‚˜ ë‚¨ì•˜ì–´!",
            image: "./images/bg_09.jpg",
            choices: [
                { text: "ë’· ì¹œêµ¬ì—ê²Œ 'ë„ˆ ë¨¹ì„ë˜?' ì–‘ë³´í•œë‹¤.", effects: { care: 12, mind: 8 } },
                { text: "ê°€ìœ„ë°”ìœ„ë³´ë¡œ ì •í•˜ìê³  ì œì•ˆí•œë‹¤.", effects: { respect: 5, coop: 5 } },
                { text: "ë‚´ê°€ ì½ì‹¸ê²Œ ì§‘ì–´ì„œ ë¨¹ëŠ”ë‹¤.", effects: { care: -5 } }
            ]
        },
        {
            text: "ì¹œí•œ ì¹œêµ¬ì™€ ì‚¬ì†Œí•œ ì¼ë¡œ ë‹¤í‰œì–´. ë§ˆìŒì´ ë¶ˆí¸í•´.",
            image: "./images/bg_10.jpg",
            choices: [
                { text: "ìª½ì§€ì— 'ì•„ê¹Œ ë¯¸ì•ˆí–ˆì–´'ë¼ê³  ì¨ì„œ ê±´ë„¨ë‹¤.", effects: { mind: 10, coop: 8 } },
                { text: "ì¹œêµ¬ê°€ ë¨¼ì € ì‚¬ê³¼í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤.", effects: { mind: -3 } },
                { text: "ë‹¤ë¥¸ ì¹œêµ¬ë“¤ì—ê²Œ ê·¸ ì¹œêµ¬ í‰ì„ ë³¸ë‹¤.", effects: { respect: -12, coop: -10 } }
            ]
        },
        {
            text: "ì²­ì†Œ ì‹œê°„. ë‚´ ë‹´ë‹¹ êµ¬ì—­ ì²­ì†Œê°€ ëë‚¬ëŠ”ë°, ì¹ íŒ ë‹¹ë²ˆì´ í˜ë“¤ì–´ ë³´ì—¬.",
            image: "./images/bg_11.jpg",
            choices: [
                { text: "ê°€ì„œ ì¹ íŒ ì§€ìš°ëŠ” ê²ƒì„ ë„ì™€ì¤€ë‹¤.", effects: { coop: 10, care: 10 } },
                { text: "'í˜ë‚´!'ë¼ê³  ë§í•´ì£¼ê³  ë‚´ ìë¦¬ì— ì•‰ëŠ”ë‹¤.", effects: { care: 3 } },
                { text: "ë‚´ í•  ì¼ ëë‚¬ìœ¼ë‹ˆ ì§‘ì— ê°ˆ ì¤€ë¹„ë‚˜ í•œë‹¤.", effects: { coop: -5 } }
            ]
        },
        {
            text: "í•˜êµ í›„ ì§‘ì— ëŒì•„ì™€ ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ë– ì˜¬ë ¤ ë³¸ë‹¤. ì–´ë–¤ í•˜ë£¨ì˜€ì„ê¹Œ?",
            image: "./images/bg_12.jpg",
            choices: [
                { text: "ì˜¤ëŠ˜ ì‹¤ìˆ˜í•œ ê±´ ê³ ì¹˜ê³  ë‚´ì¼ì€ ë” ì˜í•´ì•¼ì§€!", effects: { mind: 10, respect: 5 } },
                { text: "í”¼ê³¤í–ˆë‹¤. ê·¸ëƒ¥ ë¹¨ë¦¬ ìì•¼ì§€.", effects: { mind: 3 } },
                { text: "í•™êµ ë‹¤ë‹ˆê¸° ì‹«ë‹¤... ì§œì¦ë§Œ ë‚¬ì–´.", effects: { mind: -5 } }
            ]
        }
    ];

    // --- ê²Œì„ ë¡œì§ ---

    function selectChar(charId) {
        player.char = charId;
        document.querySelectorAll('.char-option').forEach(el => el.classList.remove('selected'));
        document.getElementById('char-' + charId).classList.add('selected');
    }

    function startGame() {
        const nameInput = document.getElementById('player-name').value;
        if (!nameInput) {
            alert("ì´ë¦„ì„ ì…ë ¥í•´ì¤˜!");
            return;
        }
        if (!player.char) {
            alert("ìºë¦­í„°ë¥¼ ì„ íƒí•´ì¤˜!");
            return;
        }
        player.name = nameInput;
        
        // í—¤ë”ì— ìºë¦­í„° ì •ë³´ ë°˜ì˜
        document.getElementById('header-player-name').innerText = player.name;
        document.getElementById('header-char-img').style.backgroundImage = `url('./images/char_${player.char}.png')`;

        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        
        renderScene();
    }

    function updateStats(effects) {
        for (let key in effects) {
            const change = effects[key];
            stats[key] += change;
            
            // ë²”ìœ„ ì œí•œ (0~100)
            if (stats[key] > 100) stats[key] = 100;
            if (stats[key] < 0) stats[key] = 0;
            
            // UI ì—…ë°ì´íŠ¸
            const bar = document.getElementById(`bar-${key}`);
            const val = document.getElementById(`val-${key}`);
            
            bar.style.width = stats[key] + '%';
            val.innerText = stats[key];

            showFloatingText(key, change);
        }
    }

    function showFloatingText(key, change) {
        if (change === 0) return;

        const statBox = document.getElementById(`stat-box-${key}`);
        const floatEl = document.createElement('span');
        
        floatEl.className = 'stat-float ' + (change > 0 ? 'plus' : 'minus');
        floatEl.innerText = (change > 0 ? '+' : '') + change;
        
        statBox.appendChild(floatEl);

        setTimeout(() => {
            floatEl.remove();
        }, 1000);
    }

    function triggerEffect(effects) {
        const isBad = Object.values(effects).some(val => val <= -5);
        if (isBad) {
            document.body.classList.add('dark-mood');
            setTimeout(() => {
                document.body.classList.remove('dark-mood');
            }, 500);
        }
    }

    function renderScene() {
        const scene = scenes[currentScene];
        const imgEl = document.getElementById('scene-img');
        const boxEl = document.getElementById('scene-box');
        
        boxEl.classList.remove('zoom-in');
        imgEl.style.opacity = 0;
        
        setTimeout(() => {
            imgEl.src = scene.image;
            document.getElementById('scene-text').textContent = scene.text;
            
            const choicesContainer = document.getElementById('choices-container');
            choicesContainer.innerHTML = '';
            
            boxEl.classList.add('zoom-in');

            scene.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'btn btn-choice';
                btn.textContent = choice.text;
                
                btn.onclick = () => {
                    const allBtns = document.querySelectorAll('.btn-choice');
                    allBtns.forEach(b => b.disabled = true);

                    updateStats(choice.effects);
                    triggerEffect(choice.effects);

                    setTimeout(() => {
                        nextScene();
                    }, 1000); 
                };
                choicesContainer.appendChild(btn);
            });
            
            imgEl.style.opacity = 1;
        }, 200);
    }

    function nextScene() {
        currentScene++;
        if (currentScene < scenes.length) {
            renderScene();
        } else {
            showEnding();
        }
    }

    function showEnding() {
        document.getElementById('game-screen').classList.add('hidden');
        document.getElementById('ending-screen').classList.remove('hidden');

        const totalScore = stats.care + stats.respect + stats.coop + stats.mind;
        
        const sortedStats = Object.entries(stats).sort((a, b) => b[1] - a[1]);
        const maxStat = sortedStats[0];    
        const minStat = sortedStats[3];    

        let endingType = "";
        let endingTitle = "";
        let endingDesc = "";
        let endingImgSrc = "";

        if (totalScore >= 280) {
            endingType = "happy";
            endingImgSrc = "./images/ending_happy.jpg";
            switch(maxStat[0]) {
                case 'care': endingTitle = "ëª¨ë‘ì—ê²Œ ë¯¿ìŒë°›ëŠ” ì¹œêµ¬"; endingDesc = "ë„ˆì˜ ë”°ëœ»í•œ ë°°ë ¤ ë•ë¶„ì— êµì‹¤ì´ í›ˆí›ˆí•´ì¡Œì–´!\nì¹œêµ¬ë“¤ì€ ë„¤ê°€ ìˆì–´ì„œ ì •ë§ ë“ ë“ í•˜ë‹¤ê³  ìƒê°í•´."; break;
                case 'respect': endingTitle = "ì±…ì„ê° ìˆëŠ” ë©‹ì§„ ë¦¬ë”"; endingDesc = "ìƒëŒ€ë°©ì„ ì¡´ì¤‘í•˜ëŠ” ë„ˆì˜ íƒœë„ê°€ ë¹›ë‚¬ì–´.\nì„ ìƒë‹˜ë„ ì¹œêµ¬ë“¤ë„ ë„ˆë¥¼ ì•„ì£¼ ë©‹ì§€ê²Œ ë³´ê³  ìˆì–´!"; break;
                case 'coop': endingTitle = "í•¨ê»˜ ë§Œë“œëŠ” ìš°ë¦¬ êµì‹¤"; endingDesc = "í˜¼ìë³´ë‹¤ 'í•¨ê»˜'ë¥¼ ì„ íƒí•œ ë„ˆ!\në„ˆ ë•ë¶„ì— ìš°ë¦¬ ë°˜ì€ ìµœê³ ì˜ íŒ€ì›Œí¬ë¥¼ ê°€ì§€ê²Œ ë˜ì—ˆì–´."; break;
                case 'mind': endingTitle = "ë§ˆìŒì´ ë‹¨ë‹¨í•œ ì–´ë¦°ì´"; endingDesc = "ì–´ë ¤ìš´ ìƒí™©ì—ì„œë„ ê¸ì •ì ì¸ ë§ˆìŒì„ ìƒì§€ ì•Šì•˜êµ¬ë‚˜.\në„ˆì˜ ê±´ê°•í•œ ë§ˆìŒì´ ì•ìœ¼ë¡œì˜ í•™êµìƒí™œì„ ì§€ì¼œì¤„ ê±°ì•¼."; break;
            }
        } else if (totalScore >= 240) {
            endingType = "mid";
            endingImgSrc = "./images/ending_mid.jpg";
            switch(maxStat[0]) {
                case 'care': endingTitle = "ì¡°ê¸ˆë§Œ ë” ë‹¤ê°€ê°€ë©´"; endingDesc = "ì¹œêµ¬ë¥¼ ìƒê°í•˜ëŠ” ë§ˆìŒì€ ì •ë§ ì˜ˆë».\ní•˜ì§€ë§Œ ì¡°ê¸ˆ ë” ìš©ê¸°ë¥¼ ë‚´ì„œ í‘œí˜„í–ˆë‹¤ë©´ ì–´ë• ì„ê¹Œ?"; break;
                case 'respect': endingTitle = "ì°©í•˜ì§€ë§Œ ë§ì„¤ì˜€ë˜ í•˜ë£¨"; endingDesc = "ì˜ˆì˜ ë°”ë¥¸ ëª¨ìŠµì€ ì¢‹ì•˜ì§€ë§Œ,\nê°€ë”ì€ ë„¤ ìƒê°ì„ ë” í™•ì‹¤í•˜ê²Œ ë§í•´ë„ ê´œì°®ì•„!"; break;
                case 'coop': endingTitle = "ë§ˆìŒì€ ìˆì—ˆì§€ë§Œ..."; endingDesc = "ë„ì™€ì£¼ê³  ì‹¶ì€ ë§ˆìŒì€ ê°€ë“í–ˆì§€?\në‹¤ìŒì—ëŠ” ìƒê°ë§Œ í•˜ì§€ ë§ê³  ì†ì„ ë¨¼ì € ë‚´ë°€ì–´ ë³´ì."; break;
                case 'mind': endingTitle = "í”ë“¤ë¦¬ëŠ” ìƒˆì‹¹"; endingDesc = "ì˜¤ëŠ˜ í•˜ë£¨ ì˜ ë²„í…¼ì–´!\ní•˜ì§€ë§Œ í˜ë“  ì¼ì´ ìˆì„ ë• í˜¼ì ë™ë™ ì•“ì§€ ë§ê³  ë„ì›€ì„ ì²­í•´ë´."; break;
            }
        } else {
            endingType = "bad";
            endingImgSrc = "./images/ending_bad.jpg";
            switch(minStat[0]) {
                case 'care': endingTitle = "ì¡°ê¸ˆ ì™¸ë¡œìš´ êµì‹¤"; endingDesc = "ë‚˜ë§Œ ìƒê°í•˜ë‹¤ ë³´ë‹ˆ ì¹œêµ¬ë“¤ì´ ë©€ì–´ì§„ ê²ƒ ê°™ì•„.\në‚´ì¼ì€ ì¹œêµ¬ì—ê²Œ ë¨¼ì € ì‚¬íƒ• í•˜ë‚˜ ê±´ë„¤ë³´ëŠ” ê±´ ì–´ë•Œ?"; break;
                case 'respect': endingTitle = "í”ë“¤ë¦¬ëŠ” êµì‹¤"; endingDesc = "ì¥ë‚œì´ ë„ˆë¬´ ì‹¬í–ˆë‚˜ ë´.\nì˜ˆì˜ë¥¼ ì§€í‚¤ëŠ” ê²ƒì´ ì¿¨í•˜ê³  ë©‹ì§„ ê±°ë¼ëŠ” ê±¸ ìŠì§€ ë§ˆ!"; break;
                case 'coop': endingTitle = "ì„œë¡œ ë©€ì–´ì§„ ìš°ë¦¬"; endingDesc = "í˜¼ìê°€ í¸í•  ìˆ˜ë„ ìˆì§€ë§Œ,\ní•™êµëŠ” ê°™ì´ ìƒí™œí•˜ëŠ” ê³³ì´ë¼ëŠ” ê±¸ ê¸°ì–µí•´ì¤˜."; break;
                case 'mind': endingTitle = "ë§ˆìŒì´ ì§€ì¹œ í•˜ë£¨"; endingDesc = "ì§œì¦ ë‚´ê³  í”¼í•˜ê¸°ë§Œ í•˜ë‹ˆ ë§ˆìŒì´ ë” í˜ë“¤ì§€?\në‚´ì¼ì€ ê¸ì •ì ì¸ ë§ˆìŒìœ¼ë¡œ ë‹¤ì‹œ ì‹œì‘í•´ë³´ì!"; break;
            }
        }

        document.getElementById('ending-img').src = endingImgSrc;
        document.getElementById('ending-title').innerText = endingTitle;
        document.getElementById('ending-desc').innerText = endingDesc;
        document.getElementById('final-name').innerText = player.name;
        document.getElementById('total-score').innerText = totalScore;
    }

    function saveEndingImage() {
        const element = document.getElementById("ending-card");
        
        html2canvas(element, { useCORS: true }).then(canvas => {
            const link = document.createElement("a");
            link.download = `${player.name}_í•™êµìƒí™œê²°ê³¼.png`;
            link.href = canvas.toDataURL();
            link.click();
            
            const toast = document.getElementById('toast');
            toast.style.opacity = 1;
            setTimeout(() => { toast.style.opacity = 0; }, 2000);
        });
    }
</script>

</body>
</html>
